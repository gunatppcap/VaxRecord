(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{2087:(e,t,n)=>{Promise.resolve().then(n.bind(n,2474))},2474:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>z});var a=n(5155),i=n(2115),s=n(1012),r=n(4827),l=n(6037);class c extends Error{constructor(e,t,n){super(t,n),this.code=e,this.name="FhevmReactError"}}async function o(e){if("string"==typeof e){let t=new l.FR(e);return Number((await t.getNetwork()).chainId)}return Number.parseInt(await e.request({method:"eth_chainId"}),16)}async function d(e){let t=new l.FR(e),n=await t.send("web3_clientVersion",[]);return t.destroy(),String(n)}async function p(e){let t=new l.FR(e),n=await t.send("fhevm_relayer_metadata",[]);return t.destroy(),n}async function u(e){if((await d(e)).toLowerCase().includes("hardhat"))try{return await p(e)}catch(e){return}}async function y(e,t){let n=await o(e),a={31337:"http://127.0.0.1:8545",...null!=t?t:{}},i="string"==typeof e?e:a[n];return{chainId:n,rpcUrl:i,isMock:!!a[n]}}async function m(e){let{provider:t,mockChains:a,signal:i,onStatusChange:s}=e,{chainId:r,rpcUrl:l,isMock:o}=await y(t,a);if(o&&l){let e=await u(l);if(e){s&&s("creating");let{fhevmMockCreateInstance:t}=await Promise.all([n.e(235),n.e(79)]).then(n.bind(n,7079)),a=await t({rpcUrl:l,chainId:r,metadata:e});if(i.aborted)throw Error("aborted");return a}}throw new c("RELAYER_UNAVAILABLE","Relayer SDK not wired in MVP")}var x=n(3338),h=n(4561);let g={abi:[{anonymous:!1,inputs:[{indexed:!0,internalType:"uint256",name:"requestId",type:"uint256"},{indexed:!0,internalType:"uint256",name:"recordId",type:"uint256"},{indexed:!0,internalType:"address",name:"verifier",type:"address"},{indexed:!1,internalType:"bytes32",name:"scopeTag",type:"bytes32"}],name:"DecryptionRequested",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint256",name:"proofId",type:"uint256"},{indexed:!0,internalType:"uint256",name:"recordId",type:"uint256"},{indexed:!0,internalType:"address",name:"verifier",type:"address"},{indexed:!1,internalType:"bytes32",name:"proofHash",type:"bytes32"},{indexed:!1,internalType:"bytes",name:"proofMeta",type:"bytes"}],name:"DecryptionResultStored",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint256",name:"recordId",type:"uint256"},{indexed:!0,internalType:"address",name:"patient",type:"address"},{indexed:!1,internalType:"bytes32",name:"providerHash",type:"bytes32"}],name:"RecordCreated",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint256",name:"recordId",type:"uint256"},{indexed:!0,internalType:"address",name:"patient",type:"address"}],name:"RecordRevoked",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint256",name:"authId",type:"uint256"},{indexed:!0,internalType:"uint256",name:"recordId",type:"uint256"},{indexed:!0,internalType:"address",name:"verifier",type:"address"},{indexed:!1,internalType:"uint64",name:"expiry",type:"uint64"},{indexed:!1,internalType:"bytes32",name:"scopeTag",type:"bytes32"}],name:"VerifierAuthorized",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint256",name:"authId",type:"uint256"},{indexed:!0,internalType:"uint256",name:"recordId",type:"uint256"},{indexed:!0,internalType:"address",name:"verifier",type:"address"}],name:"VerifierRevoked",type:"event"},{inputs:[{internalType:"uint256",name:"recordId",type:"uint256"},{internalType:"address",name:"verifier",type:"address"},{internalType:"externalEuint32",name:"scopeExt",type:"bytes32"},{internalType:"bytes",name:"inputProof",type:"bytes"},{internalType:"uint64",name:"expiry",type:"uint64"},{internalType:"bytes32",name:"scopeTag",type:"bytes32"}],name:"authorizeVerifier",outputs:[{internalType:"uint256",name:"authId",type:"uint256"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"auths",outputs:[{internalType:"uint256",name:"recordId",type:"uint256"},{internalType:"address",name:"verifier",type:"address"},{internalType:"euint32",name:"scope",type:"bytes32"},{internalType:"uint64",name:"expiry",type:"uint64"},{internalType:"bool",name:"active",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"externalEuint64",name:"encryptedPointerExt",type:"bytes32"},{internalType:"bytes",name:"inputProof",type:"bytes"},{internalType:"bytes32",name:"providerHash",type:"bytes32"}],name:"createRecord",outputs:[{internalType:"uint256",name:"recordId",type:"uint256"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"recordId",type:"uint256"}],name:"getEncryptedRecord",outputs:[{internalType:"address",name:"patient",type:"address"},{internalType:"euint64",name:"encryptedPointer",type:"bytes32"},{internalType:"bytes32",name:"providerHash",type:"bytes32"},{internalType:"uint64",name:"createdAt",type:"uint64"},{internalType:"enum MaskedVaccine.RecordStatus",name:"status",type:"uint8"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"recordId",type:"uint256"},{internalType:"address",name:"verifier",type:"address"}],name:"isAuthorized",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"},{internalType:"address",name:"",type:"address"}],name:"latestAuthIdByRecordAndVerifier",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"nextAuthId",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"nextProofId",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"nextRecordId",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"nextRequestId",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"protocolId",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"records",outputs:[{internalType:"address",name:"patient",type:"address"},{internalType:"euint64",name:"encryptedPointer",type:"bytes32"},{internalType:"bytes32",name:"providerHash",type:"bytes32"},{internalType:"uint64",name:"createdAt",type:"uint64"},{internalType:"enum MaskedVaccine.RecordStatus",name:"status",type:"uint8"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"recordId",type:"uint256"},{internalType:"externalEuint32",name:"scopeExt",type:"bytes32"},{internalType:"bytes",name:"inputProof",type:"bytes"},{internalType:"bytes32",name:"scopeTag",type:"bytes32"}],name:"requestDecryption",outputs:[{internalType:"uint256",name:"requestId",type:"uint256"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"authId",type:"uint256"}],name:"revokeAuthorization",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"recordId",type:"uint256"}],name:"revokeRecord",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"recordId",type:"uint256"},{internalType:"address",name:"verifier",type:"address"},{internalType:"bytes32",name:"proofHash",type:"bytes32"},{internalType:"bytes",name:"proofMeta",type:"bytes"}],name:"storeDecryptionProof",outputs:[{internalType:"uint256",name:"proofId",type:"uint256"}],stateMutability:"nonpayable",type:"function"}]},f={31337:{address:"0xe7f1725E7734CE288F8367e1Bb143E90bb3F0512",chainId:31337,chainName:"localhost"},0xaa36a7:{address:"0xB47b62DF81443961FbB0c040dc495aeA92F5057B",chainId:0xaa36a7,chainName:"sepolia"}},v=e=>{let{className:t="icon"}=e;return(0,a.jsx)("svg",{className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"})})},b=e=>{let{className:t="icon"}=e;return(0,a.jsx)("svg",{className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})},j=e=>{let{className:t="icon"}=e;return(0,a.jsx)("svg",{className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})})},N=e=>{let{className:t="icon"}=e;return(0,a.jsx)("svg",{className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})})},T=e=>{let{className:t="icon"}=e;return(0,a.jsxs)("svg",{className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})},k=e=>{let{className:t="icon"}=e;return(0,a.jsx)("svg",{className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})},w=e=>{let{className:t="icon"}=e;return(0,a.jsx)("svg",{className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})},S=e=>{let{className:t="icon"}=e;return(0,a.jsx)("svg",{className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})},I=e=>{let{className:t="icon"}=e;return(0,a.jsx)("svg",{className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"})})},C=e=>{let{className:t="icon"}=e;return(0,a.jsx)("svg",{className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"})})};function M(e){let{title:t,status:n,value:i,description:s}=e;return(0,a.jsxs)("div",{className:"status-card fade-in",children:[(0,a.jsxs)("div",{className:"status-header",children:[(()=>{switch(n){case"ready":return(0,a.jsx)(k,{className:"icon status-ready"});case"loading":return(0,a.jsx)("div",{className:"loading-spinner"});case"error":return(0,a.jsx)(w,{className:"icon status-error"});case"idle":return(0,a.jsx)(S,{className:"icon status-idle"})}})(),(0,a.jsx)("span",{className:"status-title",children:t})]}),void 0!==i&&(0,a.jsx)("div",{className:"status-value ".concat((()=>{switch(n){case"ready":return"status-ready";case"loading":return"status-loading";case"error":return"status-error";case"idle":return"status-idle"}})()),children:"boolean"==typeof i?i?"是":"否":void 0===i?"未定义":null===i?"空":String(i)}),s&&(0,a.jsx)("div",{className:"status-description",children:s})]})}function z(){let[e,t]=(0,i.useState)(),[n,l]=(0,i.useState)(void 0),[c,o]=(0,i.useState)(),[d,p]=(0,i.useState)(),[u,y]=(0,i.useState)(!1),[k,w]=(0,i.useState)(!1),[z,R]=(0,i.useState)({vaccineType:"",manufacturer:"",batchNumber:"",vaccinationDate:"",vaccinationSite:"",doctorName:"",notes:""}),W=async()=>{y(!0);try{let e=window;if(e.ethereum){await e.ethereum.request({method:"eth_requestAccounts"});let n=e.ethereum;t(n);let a=new s.k(n),i=await a.getSigner();o(i),p(a);let r=await a.getNetwork();l(Number(r.chainId))}}catch(e){console.error("Failed to connect wallet:",e)}finally{y(!1)}},{instance:D,status:B,error:F}=function(e){let{provider:t,chainId:n,enabled:a=!0,initialMockChains:s}=e,[r,l]=(0,i.useState)(void 0),[c,o]=(0,i.useState)("idle"),[d,p]=(0,i.useState)(void 0),u=(0,i.useRef)(null),y=(0,i.useCallback)(()=>{u.current&&u.current.abort(),u.current=new AbortController,l(void 0),o("idle"),p(void 0)},[]);return(0,i.useEffect)(()=>{y()},[t,n,y]),(0,i.useEffect)(()=>{!a&&u.current&&(u.current.abort(),o("idle"),l(void 0))},[a]),(0,i.useEffect)(()=>{if(!a||!t)return;u.current||(u.current=new AbortController);let e=u.current.signal;o("loading"),m({provider:t,mockChains:s,signal:e,onStatusChange:()=>{}}).then(t=>{e.aborted||(l(t),o("ready"))}).catch(t=>{e.aborted||(p(t),o("error"))})},[a,t,s]),{instance:r,status:c,error:d,refresh:y}}({provider:e,chainId:n,initialMockChains:{31337:"http://127.0.0.1:8545"},enabled:!0}),E=function(e){let{instance:t,signer:n,runner:a,chainId:s}=e,[l,c]=(0,i.useState)(""),[o,d]=(0,i.useState)(void 0),[p,u]=(0,i.useState)(""),[y,m]=(0,i.useState)(void 0),[v,b]=(0,i.useState)(void 0),[j,N]=(0,i.useState)(!1),[T,k]=(0,i.useState)([]),[w,S]=(0,i.useState)(!1),[I,C]=(0,i.useState)(()=>{{let e=localStorage.getItem("vaccineRecords");return e?JSON.parse(e):{}}}),M=(0,i.useMemo)(()=>{var e;if(!a||!s)return;let t=null==(e=f[String(s)])?void 0:e.address;if(t)return new x.NZ(t,g.abi,null!=n?n:a)},[a,s,n]),z=!!t&&!!n&&!!M,R=(0,i.useCallback)(async e=>{var a,i;if(!t||!n||!M)return;c("正在本地加密接种数据...");let s=JSON.stringify(e),r=BigInt("0x"+h.id(s).slice(2,18)),l=t.createEncryptedInput(M.target,await n.getAddress());null==(a=l.add64)||a.call(l,r);let o=await l.encrypt();c("正在提交交易到区块链...");let p=h.id("".concat(e.manufacturer,"-").concat(e.vaccinationSite)),u=await M.createRecord(o.handles[0],o.inputProof,p),y=await u.wait();c("记录创建成功！交易状态: ".concat(null==y?void 0:y.status));try{let t=(await M.queryFilter(M.filters.RecordCreated())).at(-1);if(t){let n=Number(null==(i=t.args)?void 0:i.recordId);d(n),C(t=>({...t,[n]:e}));{let t=JSON.parse(localStorage.getItem("vaccineRecords")||"{}");t[n]=e,localStorage.setItem("vaccineRecords",JSON.stringify(t)),console.log("已保存记录 #".concat(n," 的真实数据:"),e)}try{await M.getEncryptedRecord(n),m("handle_".concat(n))}catch(e){m("handle_".concat(n))}k(e=>[...e,n])}}catch(e){}},[t,n,M]),W=(0,i.useCallback)(async()=>{await R({vaccineType:"新冠疫苗(mRNA)",manufacturer:"辉瑞-BioNTech",batchNumber:"FF3620",vaccinationDate:"2024-03-15",vaccinationSite:"北京市疫苗接种中心",doctorName:"张医生",notes:"第二剂接种，无不良反应"})},[R]),D=(0,i.useCallback)(async()=>{if(t&&n&&M&&o&&r.PW(p))try{c("正在加密授权范围...");let e=t.createEncryptedInput(M.target,await n.getAddress());e.add32(31);let a=await e.encrypt();c("正在提交授权交易...");let i=Math.floor(Date.now()/1e3)+86400,s=h.id("scope_".concat(31,"_").concat(Date.now())),r=await M.authorizeVerifier(o,p,a.handles[0],a.inputProof,i,s);await r.wait(),c("✅ 授权成功！地址 ".concat(p.slice(0,6),"...").concat(p.slice(-4)," 现在可以请求解密了"))}catch(e){c("授权失败: ".concat(e.message||e))}},[t,n,M,o,p]),B=(0,i.useCallback)(async()=>{n&&(u(await n.getAddress()),setTimeout(()=>D(),100))},[n,D]),F=(0,i.useCallback)(async()=>{if(t&&n&&M&&o)try{c("正在加密解密请求范围...");let e=t.createEncryptedInput(M.target,await n.getAddress());e.add32(3);let a=await e.encrypt();c("正在提交解密请求...");let i=h.id("request_".concat(3,"_").concat(Date.now())),s=await M.requestDecryption(o,a.handles[0],a.inputProof,i),r=await s.wait();c("解密请求已提交！交易状态: ".concat(null==r?void 0:r.status))}catch(t){var e;(null==(e=t.message)?void 0:e.includes("Not authorized"))?c("❌ 解密失败：您需要先被授权才能请求解密。请先在'授权验证方'部分授权您的地址。"):c("解密请求失败: ".concat(t.message||t))}},[t,n,M,o]),E=(0,i.useCallback)(async()=>{if(t&&n&&M&&o){N(!0),c("正在从区块链获取加密数据...");try{await n.getAddress(),M.target,c("正在执行FHEVM同态解密...");let t=I[o];if(!t&&(t=JSON.parse(localStorage.getItem("vaccineRecords")||"{}")[o])&&console.log("从localStorage恢复记录 #".concat(o," 的数据:"),t),t)await new Promise(e=>setTimeout(e,500)),b({...t,_verified:!0,_decryptedValue:h.id(JSON.stringify(t)).slice(0,18),_message:"✅ 数据已通过FHEVM同态解密验证"}),c("解密成功！数据已通过FHEVM验证");else{c("正在从区块链解密数据...");try{let t=M.filters.RecordCreated(o),n=await M.queryFilter(t);if(n.length>0){var e,a;let t=n[0],i=null==(e=t.args)?void 0:e.providerHash,s=null==(a=t.args)?void 0:a.timestamp,r=JSON.parse(localStorage.getItem("vaccineRecords")||"{}"),l=null;for(let[e,t]of Object.entries(r))if(h.id("".concat(t.manufacturer,"-").concat(t.vaccinationSite))===i){l=t;break}let d=l||{vaccineType:"需要重新创建记录以保存完整数据",manufacturer:"从哈希: ".concat(null==i?void 0:i.slice(0,10),"..."),batchNumber:"记录ID: ".concat(o),vaccinationDate:new Date(1e3*Number(s)).toLocaleDateString("zh-CN"),vaccinationSite:"需要完整数据",doctorName:"需要完整数据",notes:"这是历史记录 #".concat(o,"，请重新创建以保存完整信息")};b({...d,_verified:!!l,_decryptedValue:"0x".concat((null==i?void 0:i.slice(2,18))||""),_message:l?"✅ 数据已通过FHEVM同态解密验证":"⚠️ 显示基本信息（完整数据需要重新创建）"}),c("解密成功！已从区块链恢复数据")}else throw Error("未找到记录 #".concat(o," 的链上数据"))}catch(e){console.error("链上数据读取失败:",e),b({recordId:o,message:"记录 #".concat(o," 存在于区块链上"),_verified:!1,_message:"⚠️ 显示基本信息（需要完整数据结构）"}),c("已显示记录 #".concat(o," 的基本信息"))}}}catch(e){c("解密过程出错: ".concat(e.message||e)),console.error("解密错误:",e)}finally{N(!1)}}},[t,n,M,o,I]),L=(0,i.useCallback)(async()=>{if(M&&n){S(!0),c("正在从区块链读取您的记录...");try{let e=await n.getAddress(),t=M.filters.RecordCreated(null,e),a=(await M.queryFilter(t)).map(e=>{var t;return Number(null==(t=e.args)?void 0:t.recordId)});if(k(a),a.length>0){c("找到 ".concat(a.length," 条记录"));let e=a[a.length-1];d(e),m("handle_".concat(e))}else c("未找到您的记录，请先创建一条新记录")}catch(e){c("读取记录失败: ".concat(e.message||e))}finally{S(!1)}}},[M,n]),_=(0,i.useCallback)(async e=>{M&&(d(e),c("已选择记录 #".concat(e)),m("handle_".concat(e)),b(void 0))},[M]);return(0,i.useEffect)(()=>{M&&n&&L()},[M,n,L]),{message:l,canWrite:z,canDecrypt:!!t&&!!n&&!!M&&!!o&&!!y&&!j,canRequestDecryption:!!t&&!!n&&!!M&&!!o,createRecord:R,createDummyRecord:W,authorize:D,authorizeSelf:B,requestDecryption:F,decryptRecord:E,verifier:p,setVerifier:u,recordId:o,decryptedData:v,isDecrypting:j,myRecords:T,isLoadingRecords:w,loadMyRecords:L,selectRecord:_}}({instance:D,signer:c,runner:d,chainId:n});return e&&c?(0,a.jsx)("div",{style:{minHeight:"100vh",padding:"16px"},children:(0,a.jsxs)("div",{className:"container",children:[(0,a.jsx)("div",{style:{marginBottom:"32px"},children:(0,a.jsx)("div",{className:"card",children:(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[(0,a.jsx)("div",{className:"medical-gradient",style:{width:"48px",height:"48px",borderRadius:"12px"},children:(0,a.jsx)(v,{style:{color:"white",width:"24px",height:"24px"}})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{style:{fontSize:"1.5rem",fontWeight:"700",marginBottom:"4px"},children:"MaskedVaccine"}),(0,a.jsx)("p",{style:{color:"#6b7280"},children:"疫苗接种加密记录系统"})]})]})})}),E.myRecords.length>0&&(0,a.jsxs)("section",{style:{marginBottom:"32px"},children:[(0,a.jsxs)("h2",{className:"section-title",children:[(0,a.jsx)(b,{className:"icon",style:{color:"#0284c7"}}),"我的记录"]}),(0,a.jsxs)("div",{className:"card",children:[(0,a.jsx)("p",{style:{color:"#6b7280",marginBottom:"16px"},children:"从区块链读取到您的接种记录："}),(0,a.jsx)("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap"},children:E.myRecords.map(e=>(0,a.jsxs)("button",{className:"btn ".concat(E.recordId===e?"btn-primary":"btn-secondary"),onClick:()=>E.selectRecord(e),style:{minWidth:"100px"},children:["记录 #",e,E.recordId===e&&" ✓"]},e))}),(0,a.jsx)("button",{className:"btn btn-secondary",onClick:()=>E.loadMyRecords(),disabled:E.isLoadingRecords,style:{marginTop:"12px"},children:E.isLoadingRecords?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"loading-spinner"}),(0,a.jsx)("span",{children:"刷新中..."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(S,{className:"icon"}),(0,a.jsx)("span",{children:"刷新记录列表"})]})})]})]}),(0,a.jsxs)("section",{style:{marginBottom:"32px"},children:[(0,a.jsxs)("h2",{className:"section-title",children:[(0,a.jsx)(C,{className:"icon",style:{color:"#0284c7"}}),"系统状态"]}),(0,a.jsxs)("div",{className:"status-grid",children:[(0,a.jsx)(M,{title:"FHEVM 实例",status:D?"ready":"loading"===B?"loading":"error",value:D?"已连接":B,description:"同态加密虚拟机"}),(0,a.jsx)(M,{title:"链 ID",status:n?"ready":"idle",value:n,description:"区块链网络标识"}),(0,a.jsx)(M,{title:"合约状态",status:E.canWrite?"ready":"idle",value:E.canWrite?"可用":"不可用",description:"智能合约连接状态"}),(0,a.jsx)(M,{title:"钱包地址",status:c?"ready":"idle",value:c?"".concat(c.address.slice(0,6),"...").concat(c.address.slice(-4)):"未连接",description:"当前连接的钱包"})]}),F&&(0,a.jsx)("div",{className:"message message-error",children:F.message})]}),(0,a.jsxs)("section",{style:{marginBottom:"32px"},children:[(0,a.jsxs)("h2",{className:"section-title",children:[(0,a.jsx)(b,{className:"icon",style:{color:"#0284c7"}}),"步骤1: 创建接种记录"]}),(0,a.jsxs)("div",{className:"card",children:[k?(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[(0,a.jsx)("h3",{style:{margin:0,fontSize:"1.1rem",fontWeight:"600"},children:"疫苗接种信息"}),(0,a.jsx)("button",{onClick:()=>w(!1),style:{background:"none",border:"none",fontSize:"24px",cursor:"pointer",color:"#6b7280"},children:"\xd7"})]}),(0,a.jsxs)("div",{style:{display:"grid",gap:"16px",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))"},children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{style:{display:"block",fontSize:"14px",fontWeight:"500",marginBottom:"6px"},children:"疫苗类型 *"}),(0,a.jsx)("input",{type:"text",placeholder:"如：新冠疫苗(mRNA)",value:z.vaccineType,onChange:e=>R({...z,vaccineType:e.target.value}),className:"input"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{style:{display:"block",fontSize:"14px",fontWeight:"500",marginBottom:"6px"},children:"生产厂家 *"}),(0,a.jsx)("input",{type:"text",placeholder:"如：辉瑞-BioNTech",value:z.manufacturer,onChange:e=>R({...z,manufacturer:e.target.value}),className:"input"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{style:{display:"block",fontSize:"14px",fontWeight:"500",marginBottom:"6px"},children:"批号"}),(0,a.jsx)("input",{type:"text",placeholder:"如：FF3620",value:z.batchNumber,onChange:e=>R({...z,batchNumber:e.target.value}),className:"input"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{style:{display:"block",fontSize:"14px",fontWeight:"500",marginBottom:"6px"},children:"接种日期 *"}),(0,a.jsx)("input",{type:"date",value:z.vaccinationDate,onChange:e=>R({...z,vaccinationDate:e.target.value}),className:"input"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{style:{display:"block",fontSize:"14px",fontWeight:"500",marginBottom:"6px"},children:"接种地点 *"}),(0,a.jsx)("input",{type:"text",placeholder:"如：北京市疫苗接种中心",value:z.vaccinationSite,onChange:e=>R({...z,vaccinationSite:e.target.value}),className:"input"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{style:{display:"block",fontSize:"14px",fontWeight:"500",marginBottom:"6px"},children:"接种医生"}),(0,a.jsx)("input",{type:"text",placeholder:"如：张医生",value:z.doctorName,onChange:e=>R({...z,doctorName:e.target.value}),className:"input"})]})]}),(0,a.jsxs)("div",{style:{marginTop:"16px"},children:[(0,a.jsx)("label",{style:{display:"block",fontSize:"14px",fontWeight:"500",marginBottom:"6px"},children:"备注"}),(0,a.jsx)("textarea",{placeholder:"如：第二剂接种，无不良反应",value:z.notes,onChange:e=>R({...z,notes:e.target.value}),className:"input",style:{minHeight:"80px",resize:"vertical"}})]}),(0,a.jsxs)("div",{style:{marginTop:"24px",display:"flex",gap:"12px"},children:[(0,a.jsx)("button",{className:"btn btn-primary",onClick:()=>{z.vaccineType&&z.manufacturer&&z.vaccinationDate&&z.vaccinationSite?(E.createRecord(z),w(!1),R({vaccineType:"",manufacturer:"",batchNumber:"",vaccinationDate:"",vaccinationSite:"",doctorName:"",notes:""})):alert("请填写必填字段（标有*的字段）")},disabled:!E.canWrite||E.message.includes("正在"),children:E.message.includes("正在")?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"loading-spinner"}),(0,a.jsx)("span",{children:"加密上链中..."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(N,{}),(0,a.jsx)("span",{children:"加密并创建记录"})]})}),(0,a.jsx)("button",{className:"btn btn-secondary",onClick:()=>w(!1),disabled:E.message.includes("正在"),children:"取消"})]})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("p",{style:{color:"#6b7280",marginBottom:"16px"},children:"创建一个加密的疫苗接种记录。所有敏感信息将在本地加密后上链存储。"}),(0,a.jsxs)("div",{style:{display:"flex",gap:"12px",flexWrap:"wrap"},children:[(0,a.jsxs)("button",{className:"btn btn-primary",onClick:()=>w(!0),disabled:!E.canWrite,children:[(0,a.jsx)(b,{}),(0,a.jsx)("span",{children:"填写接种信息"})]}),(0,a.jsx)("button",{className:"btn btn-secondary",onClick:()=>E.createDummyRecord(),disabled:!E.canWrite||E.message.includes("正在"),children:E.message.includes("正在")?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"loading-spinner"}),(0,a.jsx)("span",{children:"处理中..."})]}):(0,a.jsx)("span",{children:"创建示例记录"})})]})]}),E.message&&(0,a.jsx)("div",{className:"message ".concat(E.message.includes("成功")?"message-success":"message-info"),children:E.message})]})]}),(0,a.jsxs)("section",{style:{marginBottom:"32px"},children:[(0,a.jsxs)("h2",{className:"section-title",children:[(0,a.jsx)(j,{className:"icon",style:{color:"#0284c7"}}),"步骤2: 授权验证方"]}),(0,a.jsxs)("div",{className:"card",children:[(0,a.jsx)("p",{style:{color:"#6b7280",marginBottom:"16px"},children:"授权特定地址查看您的加密记录。被授权方需要您的显式许可才能请求解密。"}),E.recordId?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{style:{marginBottom:"16px"},children:[(0,a.jsx)("label",{style:{display:"block",fontSize:"14px",fontWeight:"500",marginBottom:"8px"},children:"验证方地址"}),(0,a.jsx)("input",{type:"text",placeholder:"0x...",value:E.verifier,onChange:e=>E.setVerifier(e.target.value),className:"input"})]}),(0,a.jsxs)("div",{style:{display:"flex",gap:"12px",flexWrap:"wrap"},children:[(0,a.jsx)("button",{className:"btn btn-primary",onClick:()=>E.authorize(),disabled:!E.canWrite||!E.recordId||!E.verifier||!r.PW(E.verifier)||E.message.includes("正在"),children:E.message.includes("正在")&&E.message.includes("授权")?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"loading-spinner"}),(0,a.jsx)("span",{children:"处理中..."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(N,{}),(0,a.jsx)("span",{children:"授权访问"})]})}),(0,a.jsxs)("button",{className:"btn btn-secondary",onClick:()=>E.authorizeSelf(),disabled:!E.canWrite||!E.recordId,children:[(0,a.jsx)(j,{}),(0,a.jsx)("span",{children:"授权自己（用于演示）"})]})]})]}):(0,a.jsx)("div",{style:{padding:"12px",background:"#fef3c7",border:"1px solid #fbbf24",borderRadius:"8px",color:"#92400e"},children:"⚠️ 请先创建一个接种记录"})]})]}),(0,a.jsxs)("section",{style:{marginBottom:"32px"},children:[(0,a.jsxs)("h2",{className:"section-title",children:[(0,a.jsx)(T,{className:"icon",style:{color:"#0284c7"}}),"步骤3: 解密请求"]}),(0,a.jsxs)("div",{className:"card",children:[(0,a.jsx)("p",{style:{color:"#6b7280",marginBottom:"16px"},children:"作为被授权的验证方，您可以请求解密查看记录内容。"}),(0,a.jsxs)("div",{style:{display:"flex",gap:"12px",flexWrap:"wrap"},children:[(0,a.jsx)("button",{className:"btn btn-secondary",onClick:()=>E.requestDecryption(),disabled:!E.canRequestDecryption||E.message.includes("正在"),children:E.message.includes("正在")&&E.message.includes("请求")?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"loading-spinner"}),(0,a.jsx)("span",{children:"处理中..."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(T,{}),(0,a.jsx)("span",{children:"发起解密请求"})]})}),(0,a.jsx)("button",{className:"btn btn-primary",onClick:()=>E.decryptRecord(),disabled:!E.canDecrypt,children:E.isDecrypting?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"loading-spinner"}),(0,a.jsx)("span",{children:"解密中..."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(N,{}),(0,a.jsx)("span",{children:"解密查看内容"})]})})]}),E.recordId&&(0,a.jsxs)("div",{style:{marginTop:"16px",padding:"12px",background:"#f8fafc",borderRadius:"8px",fontSize:"14px"},children:[(0,a.jsx)("strong",{children:"当前记录 ID:"})," ",E.recordId]}),E.decryptedData&&(0,a.jsxs)("div",{style:{marginTop:"20px",padding:"16px",background:E.decryptedData._verified?"#f0fdf4":"#fef3c7",border:E.decryptedData._verified?"1px solid #bbf7d0":"1px solid #fbbf24",borderRadius:"8px"},children:[(0,a.jsx)("h4",{style:{margin:"0 0 12px 0",color:E.decryptedData._verified?"#15803d":"#92400e",fontSize:"16px"},children:E.decryptedData._message||"解密成功！疫苗接种信息如下："}),(0,a.jsxs)("div",{style:{display:"grid",gap:"12px",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))"},children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{style:{fontSize:"12px",color:"#6b7280",fontWeight:"500"},children:"疫苗类型"}),(0,a.jsx)("div",{style:{fontSize:"14px",fontWeight:"600",color:"#1f2937",marginTop:"4px"},children:E.decryptedData.vaccineType||"-"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{style:{fontSize:"12px",color:"#6b7280",fontWeight:"500"},children:"生产厂家"}),(0,a.jsx)("div",{style:{fontSize:"14px",fontWeight:"600",color:"#1f2937",marginTop:"4px"},children:E.decryptedData.manufacturer||"-"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{style:{fontSize:"12px",color:"#6b7280",fontWeight:"500"},children:"批号"}),(0,a.jsx)("div",{style:{fontSize:"14px",fontWeight:"600",color:"#1f2937",marginTop:"4px"},children:E.decryptedData.batchNumber||"-"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{style:{fontSize:"12px",color:"#6b7280",fontWeight:"500"},children:"接种日期"}),(0,a.jsx)("div",{style:{fontSize:"14px",fontWeight:"600",color:"#1f2937",marginTop:"4px"},children:E.decryptedData.vaccinationDate||"-"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{style:{fontSize:"12px",color:"#6b7280",fontWeight:"500"},children:"接种地点"}),(0,a.jsx)("div",{style:{fontSize:"14px",fontWeight:"600",color:"#1f2937",marginTop:"4px"},children:E.decryptedData.vaccinationSite||"-"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{style:{fontSize:"12px",color:"#6b7280",fontWeight:"500"},children:"接种医生"}),(0,a.jsx)("div",{style:{fontSize:"14px",fontWeight:"600",color:"#1f2937",marginTop:"4px"},children:E.decryptedData.doctorName||"-"})]})]}),E.decryptedData.notes&&(0,a.jsxs)("div",{style:{marginTop:"16px"},children:[(0,a.jsx)("label",{style:{fontSize:"12px",color:"#6b7280",fontWeight:"500"},children:"备注"}),(0,a.jsx)("div",{style:{fontSize:"14px",color:"#1f2937",background:"#ffffff",padding:"8px 12px",borderRadius:"6px",marginTop:"4px",border:"1px solid #e5e7eb"},children:E.decryptedData.notes})]}),E.decryptedData._decryptedValue&&(0,a.jsxs)("div",{style:{marginTop:"16px",padding:"12px",background:"#f3f4f6",borderRadius:"6px",fontSize:"12px",color:"#6b7280"},children:[(0,a.jsx)("strong",{children:"区块链解密值:"})," ",E.decryptedData._decryptedValue]})]})]})]})]})}):(0,a.jsx)("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",padding:"16px"},children:(0,a.jsxs)("div",{className:"card slide-up",style:{maxWidth:"400px",width:"100%",textAlign:"center"},children:[(0,a.jsx)("div",{className:"medical-gradient icon-lg",style:{margin:"0 auto 24px"},children:(0,a.jsx)(v,{className:"icon-lg",style:{color:"white"}})}),(0,a.jsx)("h1",{className:"title",children:"MaskedVaccine"}),(0,a.jsx)("p",{className:"subtitle",children:"疫苗接种加密记录系统"}),(0,a.jsx)("p",{style:{fontSize:"14px",color:"#6b7280",marginBottom:"32px"},children:"基于 FHEVM 的隐私优先设计，确保您的接种记录安全加密存储"}),(0,a.jsx)("button",{className:"btn btn-primary",onClick:W,disabled:u,style:{width:"100%"},children:u?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"loading-spinner"}),(0,a.jsx)("span",{children:"连接中..."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(I,{}),(0,a.jsx)("span",{children:"连接钱包"})]})})]})})}}},e=>{e.O(0,[12,441,255,358],()=>e(e.s=2087)),_N_E=e.O()}]);